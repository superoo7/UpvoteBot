{"version":3,"sources":["../src/index.js"],"names":["main","author","permlink","config","maximumPostAge","minimumLength","optimumLength","aboutPost","then","console","log","data","msg","created","isCheetah","articleLength","checkPostAge","minimumPostAge","createdTime","beautifyDate","weightage","weightageForPost","time","catch","Promise","resolve","reject","api","getContent","err","result","id","active_votes","filter","voter","length","bodyParse1","body","bodyParse2","upvote","steem_posting_key","steem_username","broadcast","vote","block_num","isoDate","unixDate","Date","replace","now","postLength","parseInt","fromNow"],"mappings":"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","file":"index.js","sourcesContent":["import steem from 'steem';\nimport moment from 'moment';\n\nimport 'babel-polyfill';\n\nimport {\n  imageParser,\n  linkParser,\n  divParser,\n  breakLineParser\n} from './regex';\n\nfunction main(author, permlink, config) {\n  const {\n    maximumPostAge,\n    minimumLength,\n    optimumLength\n  } = config;\n\n  return aboutPost(author, permlink)\n    .then(data => {\n      console.log(data);\n      if (data === 'POST_NOT_FOUND') {\n        return { msg: 'POST_NOT_FOUND' };\n      }\n\n      const {\n        author,\n        permlink,\n        created,\n        isCheetah,\n        articleLength\n      } = data;\n      if (isCheetah) {\n        return { msg: 'CHEETAH' };\n      } else if (\n        checkPostAge(\n          created,\n          maximumPostAge,\n          minimumPostAge\n        )\n      ) {\n        // 3.5 days\n        return { msg: 'OLD_POST' };\n      } else {\n        let createdTime = beautifyDate(created);\n        let weightage = weightageForPost(\n          articleLength,\n          minimumLength,\n          optimumLength\n        );\n        return {\n          time: createdTime,\n          weightage,\n          author,\n          permlink,\n          msg: `The post is created ${createdTime} and will be upvoted by ${weightage /\n            100}%`\n        };\n      }\n    })\n    .catch(error => {\n      msg: 'POST_NOT_FOUND';\n    });\n}\n\n// ABOUT THE POST\n\nfunction aboutPost(author, permlink) {\n  return new Promise(function(resolve, reject) {\n    steem.api.getContent(author, permlink, function(\n      err,\n      result\n    ) {\n      if (\n        err ||\n        (result.id === 0 &&\n          result.author === '' &&\n          result.permlink === '')\n      ) {\n        reject('ERROR');\n      }\n\n      const isCheetah = !(\n        result.active_votes.filter(data => {\n          if (data.voter === 'cheetah') {\n            return true;\n          }\n          return false;\n        }).length === 0\n      );\n\n      const bodyParse1 = imageParser(result.body);\n      const bodyParse2 = linkParser(bodyParse1);\n      const articleLength = bodyParse2.length;\n\n      resolve({\n        author: result.author,\n        permlink,\n        created: result.created,\n        isCheetah,\n        articleLength\n      });\n    });\n  }).catch(err => 'POST_NOT_FOUND');\n}\n\n// UPVOTE\n\nfunction upvote(\n  steem_posting_key,\n  steem_username,\n  author,\n  permlink,\n  weightage\n) {\n  return new Promise(function(resolve, reject) {\n    steem.broadcast.vote(\n      steem_posting_key,\n      steem_username,\n      author,\n      permlink,\n      weightage,\n      function(err, result) {\n        if (err) {\n          reject('ERROR');\n        } else if (!result) {\n          reject('ERROR');\n        } else if (!!result.id && !!result.block_num) {\n          resolve(result);\n        } else {\n          reject('ERROR');\n        }\n      }\n    );\n  }).catch(err => 'ERROR');\n}\n\nfunction checkPostAge(\n  isoDate,\n  maximumPostAge,\n  minimumPostAge\n) {\n  const unixDate = new Date(\n    isoDate\n      .replace(/-/g, '/')\n      .replace('T', ' ')\n      .replace('Z', '')\n  );\n\n  return (\n    Date.now() - unixDate > maximumPostAge ||\n    Date.now() - unixDate < minimumPostAge\n  );\n}\n\nfunction weightageForPost(\n  postLength,\n  minimumLength,\n  optimumLength\n) {\n  if (postLength < minimumLength) {\n    // 10% VP\n    return 10 * 100;\n  } else if (postLength < optimumLength) {\n    // 10% ~ 80% VP\n    return parseInt(\n      (postLength - minimumLength) /\n        (optimumLength - minimumLength) *\n        70 *\n        100 +\n        10 * 100\n    );\n  } else {\n    // 80% VP\n    return 80 * 100;\n  }\n}\n\nfunction beautifyDate(isoDate) {\n  return moment(isoDate).fromNow();\n}\n\nexport {\n  main,\n  aboutPost,\n  upvote,\n  checkPostAge,\n  weightageForPost,\n  beautifyDate\n};\n"]}